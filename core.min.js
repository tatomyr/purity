const isEmpty=e=>!e||!Object.keys(e).length,clearFalsy=e=>null==e||!1===e?"":e,joinIfArray=e=>Array.isArray(e)?e.join(""):e;export const createStore=(e=(()=>({})),t=(()=>{}))=>{const r=e(void 0,{type:"INIT"}),o=e=>{const t=(new DOMParser).parseFromString(e,"text/html"),r=new Map;for(const e of t.querySelectorAll("*[id]")){const t=e.cloneNode(!0);for(const e of t.querySelectorAll("*[id]"))e.outerHTML=`\x3c!-- ${e.tagName}#${e.id} --\x3e`;for(const e of t.querySelectorAll("*[data-purity_key]"))e.removeAttribute("data-purity_key");r.set(e.id,{node:e,shallow:t})}return r};let n,c;function s(e,t){for(const{name:t}of e.attributes)"id"!==t&&e.removeAttribute(t);for(const{name:r,value:o}of t.node.attributes)"id"!==r&&e.setAttribute(r,o)}function a(){const e=o(n());for(const[t,r]of c){const o=e.get(t);if(o&&r.shallow.outerHTML!==o.shallow.outerHTML){const e=document.getElementById(t);s(e,o),r.shallow.innerHTML!==o.shallow.innerHTML&&(e.innerHTML=o.node.innerHTML,console.log(`â†» #${t}`))}}c=e}function i(o){const n=e(r,o);var c;(c=n)&&Object.keys(c).length&&(Object.assign(r,n),a()),t(o,i,r)}return{mount:function(e){n=e,c=o(n());const s=c.keys().next().value;document.getElementById(s).replaceWith(c.get(s).node),t({type:"INIT"},i,r)},dispatch:i,connect:e=>t=>e(Object.assign({},r,t)),rerender:a,getState:()=>r}};const ARGS_RE=/__\[(\d+)\]__/gm,BOUND_EVENTS_RE=/::(\w+)\s*=\s*__\[(\d+)\]__/gm;let purity_key=0;export const render=([e,...t],...r)=>{const o=t.reduce((e,t,r)=>`${e}__[${r}]__${t}`,e).replace(BOUND_EVENTS_RE,(e,t,o)=>{const n=`${purity_key}-${o}`;return setTimeout(()=>{let e=document.querySelector(`*[data-purity_key="${n}"]`);e&&(e[`on${t}`]=r[o],e.removeAttribute("data-purity_key"))}),`data-purity_key="${n}"`}).replace(ARGS_RE,(e,t)=>{return joinIfArray(null==(o=r[+t])||!1===o?"":o);var o}).trim().replace(/\n\s*</g,"<").replace(/>\n\s*/g,">");return purity_key++,setTimeout(()=>{purity_key=0}),o};
