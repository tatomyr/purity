const clearFalsy=e=>null==e||!1===e?"":e,joinIfArray=e=>Array.isArray(e)?e.join(""):e,PURITY_KEYWORD="purity",DATA_PURITY_FLAG="data-purity_flag";export const init=e=>{let t=e;const o=e=>{const t=(new DOMParser).parseFromString(e,"text/html"),o=new Map;for(const e of t.querySelectorAll("[id]")){let t=e.cloneNode(!0);for(let e of t.querySelectorAll("[id]"))e.outerHTML=`\x3c!-- ${e.tagName}#${e.id} --\x3e`;console.log("shallow---\x3e",t.outerHTML);for(let e of t.querySelectorAll("[data-purity_flag]")){console.log("         |--\x3e",e.outerHTML);for(const t in e.dataset)t.startsWith("purity")&&e.removeAttribute("data-"+t)}o.set(e.id,{node:e,shallow:t})}return o};let r,n;function l(e,t){for(const{name:t}of e.attributes)e.removeAttribute(t);for(const{name:o,value:r}of t.node.attributes)e.setAttribute(o,r)}function a(){const e=o(r());for(const[t,o]of n){const r=e.get(t);if(r&&o.shallow.outerHTML!==r.shallow.outerHTML){const e=document.getElementById(t);if(!e)throw new Error(`There is no element in DOM with id ${t}.`);l(e,r),o.shallow.innerHTML!==r.shallow.innerHTML?(e.innerHTML=r.node.innerHTML,console.log("↻ #"+t)):console.log("± #"+t)}}n=e}return{mount:function(e){r=e,n=o(r());const t=n.keys().next().value,l=document.getElementById(t),a=n.get(t)?.node;if(!l||!a)throw new Error(`Root DOM element's id does not correspond to the defined application root id (${t}).`);l.replaceWith(a)},rerender:a,getState:()=>t,setState(e){Object.assign(t,e(t)),a()}}};const ARGS_RE=/__\[(\d+)\]__/gm,BOUND_EVENTS_RE=/::(\w+)\s*=\s*__\[(\d+)\]__/gm,applyPurityKey=(()=>{let e,t=0;return()=>(e&&clearTimeout(e),e=setTimeout((()=>{t=0})),t++)})();export const render=([e,...t],...o)=>t.reduce(((e,t,o)=>`${e}__[${o}]__${t}`),e).replace(BOUND_EVENTS_RE,((e,t,r)=>{const n=`data-purity_${t}_${applyPurityKey()}`;return setTimeout((()=>{let e=document.querySelector(`[${n}]`);e&&(e["on"+t]=o[r],e.removeAttribute(n))})),n+" data-purity_flag"})).replace(ARGS_RE,((e,t)=>{return joinIfArray(null==(r=o[+t])||!1===r?"":r);var r})).trim().replace(/\n\s*</g,"<").replace(/>\n\s*/g,">");
