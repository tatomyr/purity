const PURITY_KEYWORD="purity",DATA_PURITY_FLAG="data-purity_flag";export const init=e=>{const t=e;let r,o;function n(e,t){for(const{name:t}of e.attributes)e.removeAttribute(t);for(const{name:r,value:o}of t.node.attributes)e.setAttribute(r,o)}function s(){if(!r)throw new Error("Cannot rerender: app has not been mounted. Call mount() first.");const e=r();console.warn("Updating DOM...");for(const[t,r]of o){const o=e.get(t);if(o&&r.shallow.outerHTML!==o.shallow.outerHTML){const e=document.getElementById(t);if(!e)throw new Error(`There is no element in the DOM with id "${t}".`);n(e,o),r.shallow.innerHTML!==o.shallow.innerHTML?(e.innerHTML=o.node.innerHTML,console.warn(`\tðŸ”´ #${t} re-rendered`)):console.warn(`\tðŸŸ¡ #${t} not changed`)}}o=e}return{mount:function(e){r=()=>(e=>{const t=(new DOMParser).parseFromString(e,"text/html"),r=new Map;for(const e of t.querySelectorAll("[id]")){const t=e.cloneNode(!0);for(const e of t.querySelectorAll("[id]"))e.outerHTML=`\x3c!-- ${e.tagName}#${e.id} --\x3e`;for(const e of t.querySelectorAll(`[${DATA_PURITY_FLAG}]`))for(const t in e.dataset)t.startsWith("purity")&&e.removeAttribute(`data-${t}`);r.set(e.id,{node:e,shallow:t})}return r})(e()),o=r();const t=o.keys().next().value,n=document.getElementById(t),s=o.get(t)?.node;if(!n||!s)throw new Error(`Root DOM element's id does not correspond to the defined application root id "${t}".`);n.replaceWith(s)},rerender:s,getState:()=>t,setState(e){Object.assign(t,e(t)),s()}}};const ARGS_RE=/__\[(\d+)\]__/gm,BOUND_EVENTS_RE=/::(\w+)\s*=\s*__\[(\d+)\]__/gm;export const isTruthy=e=>null!=e&&!1!==e;const clearFalsy=e=>isTruthy(e)?e:"",joinIfArray=e=>Array.isArray(e)?e.join(""):e,applyPurityKey=(()=>{let e,t=0;return()=>(e&&clearTimeout(e),e=setTimeout(()=>{t=0}),t++)})();export const render=([e,...t],...r)=>t.reduce((e,t,r)=>`${e}__[${r}]__${t}`,e).replace(BOUND_EVENTS_RE,(e,t,o)=>{const n=`data-purity_${t}_${applyPurityKey()}`;return setTimeout(()=>{const e=document.querySelector(`[${n}]`),s=r[o];e&&"function"==typeof s&&(e[`on${t}`]=s,e.removeAttribute(n))}),`${n} ${DATA_PURITY_FLAG}`}).replace(ARGS_RE,(e,t)=>joinIfArray(clearFalsy(r[+t]))).trim().replace(/\n\s*</g,"<").replace(/>\n\s*/g,">");
